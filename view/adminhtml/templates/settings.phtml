<?php

$nitroPackConfigHelper = $this->helper('NitroPack\NitroPack\Helper\NitroPackConfigHelper');
$enabledMagentoCaches = $nitroPackConfigHelper->getDisabledCaches();
$saveUrl = $block->getSaveUrl();
$purgeUrl = $block->getCachePurgeUrl();
$numberOfPageStoreWiseUrl = $block->getNumberOfPageStoreWise();
$warmupStartUrl = $block->getStartWarmupUrl();
$warmupPauseUrl = $block->getPauseWarmupUrl();
$enableCachesUrl = $block->getEnableCachesUrl();
$safeModeEnableUrl = $block->getSafeModeEnableUrl();
$storeCurrencies = $block->getAvailableCurrencies();
$storeLocales = $block->getAvailableLocales();
$settings = $block->getSettings();
?>


<div class="mb-4 mt-8 border-b dark:border-gray-700 nitro-top-tab-bar" style="border-color: #e3e3e3;">
    <ul class="flex flex-wrap -mb-px text-sm font-medium text-left" id="default-styled-tab"
        data-tabs-toggle="#default-styled-tab-content"
        data-tabs-active-classes="text-purple-600 hover:text-purple-600 dark:text-purple-500 dark:hover:text-purple-500 border-purple-600 dark:border-purple-500"
        data-tabs-inactive-classes="dark:border-transparent text-gray-500 hover:text-gray-600 dark:text-gray-400 border-gray-100 hover:border-gray-300 dark:border-gray-700 dark:hover:text-gray-300"
        role="tablist" style="height: 47px !important;">
        <li class="me-2" role="presentation">
            <button class="tab-btn inline-block pt-5 pb-5 text-gray-900 text-center tab-btn-active"
                    id="dashboard-styled-tab"
                    data-tabs-target="dashboard" type="button" role="tab" aria-controls="dashboard"
                    aria-selected="false" style="margin-right: 1rem;">Dashboard
            </button>
        </li>
        <li role="presentation">
            <button class="tab-btn inline-block pt-5 pb-5 text-center" data-tabs-target="system-info" type="button"
                    role="tab"
                    aria-controls="contacts" aria-selected="false" style="margin-right: 1rem;">System Info
            </button>
        </li>
    </ul>
</div>
<div id="default-styled-tab-content">
    <div class="tab-content py-4" id="dashboard" role="tabpanel" aria-labelledby="profile-tab">
        <form id="nitro_settings">
            <div class="grid grid-cols-2 md:grid-cols gap-8">
                <div class="gap-8">
                    <div class="row mb-8">
                        <!-- Optimized Pages Card -->
                        <?= $this->getChildHtml('OptimizedPages'); ?>
                    </div>
                    <div class="row mb-8">
                        <!-- Optimized Pages Card End -->
                        <!-- Optimization Mode Card Start -->
                        <?= $this->getChildHtml('OptimizationMode'); ?>
                    </div>
                    <!-- Optimization Mode Card End -->
                    <!-- General Block Card Start -->
                    <div class="row mb-8">
                        <?= $this->getChildHtml('GeneralBlock'); ?>
                    </div>
                    <!-- General Block Card End -->

                </div>
                <div class="gap-8">
                    <!-- Subscription Block Card Start -->
                    <div class="row mb-8">
                        <?= $this->getChildHtml('SubscriptionBlock'); ?>
                        <!-- Subscription Block Card End -->
                    </div>
                    <div class="row mb-8">
                        <!-- Product Attribute Block Card Start -->
                        <?= $this->getChildHtml('ProductAttributeBlock'); ?>
                        <!-- Product Attribute Block Card End  -->
                    </div>
                </div>
            </div>
        </form>
        <script id="template-nitropack-notification-success" type="text/template">
            <div id="nitropack-notification" class="nitro nitropack-notification" data-type="success">
                <div class="alert alert-success" id="nitropack-notification-message">
                    <div class="notification-message flex align-items-center">
                        <div class="notification-icon flex mr-2">
                            <svg width="28" height="28" viewBox="0 0 28 28" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <rect width="28" height="28" rx="14" fill="#E9FFFB"/>
                                <path d="M16.5 11.5L13.5 15.5L12 14" stroke="#00C7A2" stroke-linecap="round"
                                      stroke-linejoin="round"/>
                                <path
                                    d="M14 20.6667C17.6819 20.6667 20.6667 17.6819 20.6667 14C20.6667 10.3181 17.6819 7.33337 14 7.33337C10.3181 7.33337 7.33337 10.3181 7.33337 14C7.33337 17.6819 10.3181 20.6667 14 20.6667Z"
                                    stroke="#00C7A2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="message-content flex"> {message}</div>
                        <button id="closebutton" class="close-button flex">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                      d="M3.86361 3.86375C4.03238 3.69502 4.26126 3.60024 4.49991 3.60024C4.73855 3.60024 4.96743 3.69502 5.13621 3.86375L8.99991 7.72745L12.8636 3.86375C12.9466 3.77779 13.0459 3.70923 13.1557 3.66206C13.2655 3.61489 13.3836 3.59006 13.5031 3.58902C13.6226 3.58798 13.7412 3.61076 13.8518 3.65601C13.9624 3.70126 14.0629 3.76809 14.1474 3.85259C14.2319 3.9371 14.2987 4.03758 14.3439 4.14819C14.3892 4.2588 14.412 4.37731 14.4109 4.49681C14.4099 4.61631 14.3851 4.73441 14.3379 4.84421C14.2907 4.95402 14.2222 5.05333 14.1362 5.13635L10.2725 9.00005L14.1362 12.8637C14.3001 13.0335 14.3909 13.2608 14.3888 13.4968C14.3868 13.7328 14.2921 13.9585 14.1252 14.1254C13.9584 14.2923 13.7326 14.3869 13.4967 14.389C13.2607 14.391 13.0333 14.3003 12.8636 14.1363L8.99991 10.2726L5.13621 14.1363C4.96646 14.3003 4.73912 14.391 4.50314 14.389C4.26717 14.3869 4.04144 14.2923 3.87457 14.1254C3.7077 13.9585 3.61305 13.7328 3.611 13.4968C3.60895 13.2608 3.69966 13.0335 3.86361 12.8637L7.72731 9.00005L3.86361 5.13635C3.69488 4.96757 3.6001 4.7387 3.6001 4.50005C3.6001 4.2614 3.69488 4.03252 3.86361 3.86375Z"
                                      fill="#1B004E"/>
                            </svg>
                        </button>
                    </div>
                    <div class="toast-progress">
                        <div class="progress-bar"></div>
                    </div>
                </div>
            </div>
        </script>
        <script id="template-nitropack-notification-danger" type="text/template">
            <div id="nitropack-notification" class="nitro nitropack-notification" data-type="danger">
                <div class="alert alert-danger" id="nitropack-notification-message">
                    <div class="notification-message flex align-items-center">
                        <div class="notification-icon flex mr-2">

                            <svg width="28" height="28" viewBox="0 0 28 28" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <rect width="28" height="28" rx="14" fill="#FBECEF"/>
                                <path
                                    d="M12.6907 6.73715L6.20522 17.5641C6.07151 17.7956 6.00075 18.0582 6.00001 18.3256C5.99926 18.593 6.06854 18.8559 6.20095 19.0882C6.33337 19.3205 6.52431 19.5141 6.75477 19.6497C6.98523 19.7853 7.24718 19.8582 7.51456 19.8612H20.4854C20.7528 19.8582 21.0148 19.7853 21.2452 19.6497C21.4757 19.5141 21.6666 19.3205 21.799 19.0882C21.9315 18.8559 22.0007 18.593 22 18.3256C21.9992 18.0582 21.9285 17.7956 21.7948 17.5641L15.3093 6.73715C15.1728 6.51212 14.9806 6.32607 14.7513 6.19694C14.522 6.06782 14.2632 5.99998 14 5.99998C13.7368 5.99998 13.478 6.06782 13.2487 6.19694C13.0194 6.32607 12.8272 6.51212 12.6907 6.73715Z"
                                    stroke="#CF0C35" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 11V13.6667" stroke="#CF0C35" stroke-linecap="round"
                                      stroke-linejoin="round"/>
                                <path d="M14 16.3333H14.0067" stroke="#CF0C35" stroke-linecap="round"
                                      stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="message-content flex">{message}</div>
                        <button id="closebutton" class="close-button flex">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                      d="M3.86361 3.86375C4.03238 3.69502 4.26126 3.60024 4.49991 3.60024C4.73855 3.60024 4.96743 3.69502 5.13621 3.86375L8.99991 7.72745L12.8636 3.86375C12.9466 3.77779 13.0459 3.70923 13.1557 3.66206C13.2655 3.61489 13.3836 3.59006 13.5031 3.58902C13.6226 3.58798 13.7412 3.61076 13.8518 3.65601C13.9624 3.70126 14.0629 3.76809 14.1474 3.85259C14.2319 3.9371 14.2987 4.03758 14.3439 4.14819C14.3892 4.2588 14.412 4.37731 14.4109 4.49681C14.4099 4.61631 14.3851 4.73441 14.3379 4.84421C14.2907 4.95402 14.2222 5.05333 14.1362 5.13635L10.2725 9.00005L14.1362 12.8637C14.3001 13.0335 14.3909 13.2608 14.3888 13.4968C14.3868 13.7328 14.2921 13.9585 14.1252 14.1254C13.9584 14.2923 13.7326 14.3869 13.4967 14.389C13.2607 14.391 13.0333 14.3003 12.8636 14.1363L8.99991 10.2726L5.13621 14.1363C4.96646 14.3003 4.73912 14.391 4.50314 14.389C4.26717 14.3869 4.04144 14.2923 3.87457 14.1254C3.7077 13.9585 3.61305 13.7328 3.611 13.4968C3.60895 13.2608 3.69966 13.0335 3.86361 12.8637L7.72731 9.00005L3.86361 5.13635C3.69488 4.96757 3.6001 4.7387 3.6001 4.50005C3.6001 4.2614 3.69488 4.03252 3.86361 3.86375Z"
                                      fill="#1B004E"/>
                            </svg>
                        </button>
                    </div>
                    <div class="toast-progress">
                        <div class="progress-bar"></div>
                    </div>
                </div>
            </div>
        </script>
        <script id="template-nitropack-notification-warning" type="text/template">
            <div id="nitropack-notification" class="nitro nitropack-notification" data-type="warning">
                <div class="alert alert-warning" id="nitropack-notification-message">
                    <div class="notification-message flex align-items-center">
                        <div class="notification-icon flex mr-2">

                            <svg width="28" height="28" viewBox="0 0 28 28" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <rect width="28" height="28" rx="14" fill="#FBECEF"/>
                                <path
                                    d="M12.6907 6.73715L6.20522 17.5641C6.07151 17.7956 6.00075 18.0582 6.00001 18.3256C5.99926 18.593 6.06854 18.8559 6.20095 19.0882C6.33337 19.3205 6.52431 19.5141 6.75477 19.6497C6.98523 19.7853 7.24718 19.8582 7.51456 19.8612H20.4854C20.7528 19.8582 21.0148 19.7853 21.2452 19.6497C21.4757 19.5141 21.6666 19.3205 21.799 19.0882C21.9315 18.8559 22.0007 18.593 22 18.3256C21.9992 18.0582 21.9285 17.7956 21.7948 17.5641L15.3093 6.73715C15.1728 6.51212 14.9806 6.32607 14.7513 6.19694C14.522 6.06782 14.2632 5.99998 14 5.99998C13.7368 5.99998 13.478 6.06782 13.2487 6.19694C13.0194 6.32607 12.8272 6.51212 12.6907 6.73715Z"
                                    stroke="#CF0C35" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 11V13.6667" stroke="#CF0C35" stroke-linecap="round"
                                      stroke-linejoin="round"/>
                                <path d="M14 16.3333H14.0067" stroke="#CF0C35" stroke-linecap="round"
                                      stroke-linejoin="round"/>
                            </svg>

                        </div>
                        <div class="message-content flex"> {message}</div>
                        <button id="closebutton" class="close-button flex">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                      d="M3.86361 3.86375C4.03238 3.69502 4.26126 3.60024 4.49991 3.60024C4.73855 3.60024 4.96743 3.69502 5.13621 3.86375L8.99991 7.72745L12.8636 3.86375C12.9466 3.77779 13.0459 3.70923 13.1557 3.66206C13.2655 3.61489 13.3836 3.59006 13.5031 3.58902C13.6226 3.58798 13.7412 3.61076 13.8518 3.65601C13.9624 3.70126 14.0629 3.76809 14.1474 3.85259C14.2319 3.9371 14.2987 4.03758 14.3439 4.14819C14.3892 4.2588 14.412 4.37731 14.4109 4.49681C14.4099 4.61631 14.3851 4.73441 14.3379 4.84421C14.2907 4.95402 14.2222 5.05333 14.1362 5.13635L10.2725 9.00005L14.1362 12.8637C14.3001 13.0335 14.3909 13.2608 14.3888 13.4968C14.3868 13.7328 14.2921 13.9585 14.1252 14.1254C13.9584 14.2923 13.7326 14.3869 13.4967 14.389C13.2607 14.391 13.0333 14.3003 12.8636 14.1363L8.99991 10.2726L5.13621 14.1363C4.96646 14.3003 4.73912 14.391 4.50314 14.389C4.26717 14.3869 4.04144 14.2923 3.87457 14.1254C3.7077 13.9585 3.61305 13.7328 3.611 13.4968C3.60895 13.2608 3.69966 13.0335 3.86361 12.8637L7.72731 9.00005L3.86361 5.13635C3.69488 4.96757 3.6001 4.7387 3.6001 4.50005C3.6001 4.2614 3.69488 4.03252 3.86361 3.86375Z"
                                      fill="#1B004E"/>
                            </svg>
                        </button>
                    </div>
                    <div class="toast-progress">
                        <div class="progress-bar"></div>
                    </div>
                </div>
            </div>
        </script>
        <script id="template-nitropack-notification-info" type="text/template">
            <div id="nitropack-notification" class="nitro nitropack-notification" data-type="info">
                <div class="alert alert-info" id="nitropack-notification-message">

                    <div class="notification-message flex align-items-center">
                        <div class="notification-icon flex mr-2">
                            <svg width="28" height="28" viewBox="0 0 28 28" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <rect width="28" height="28" rx="14" fill="#E1EFFE"/>
                                <g clip-path="url(#clip0_2995_607)">
                                    <path
                                        d="M14 20.6667C17.6819 20.6667 20.6667 17.6819 20.6667 14C20.6667 10.3181 17.6819 7.33334 14 7.33334C10.3181 7.33334 7.33334 10.3181 7.33334 14C7.33334 17.6819 10.3181 20.6667 14 20.6667Z"
                                        stroke="#1A56DB" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M14 16.6667V14" stroke="#1A56DB" stroke-linecap="round"
                                          stroke-linejoin="round"/>
                                    <path d="M14 11.3333H14.0067" stroke="#1A56DB" stroke-linecap="round"
                                          stroke-linejoin="round"/>
                                </g>
                                <defs>
                                    <clipPath id="clip0_2995_607">
                                        <rect width="16" height="16" fill="white" transform="translate(6 6)"/>
                                    </clipPath>
                                </defs>
                            </svg>
                        </div>
                        <div class="message-content flex"> {message}</div>
                        <button id="closebutton" class="close-button flex">

                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                      d="M3.86361 3.86375C4.03238 3.69502 4.26126 3.60024 4.49991 3.60024C4.73855 3.60024 4.96743 3.69502 5.13621 3.86375L8.99991 7.72745L12.8636 3.86375C12.9466 3.77779 13.0459 3.70923 13.1557 3.66206C13.2655 3.61489 13.3836 3.59006 13.5031 3.58902C13.6226 3.58798 13.7412 3.61076 13.8518 3.65601C13.9624 3.70126 14.0629 3.76809 14.1474 3.85259C14.2319 3.9371 14.2987 4.03758 14.3439 4.14819C14.3892 4.2588 14.412 4.37731 14.4109 4.49681C14.4099 4.61631 14.3851 4.73441 14.3379 4.84421C14.2907 4.95402 14.2222 5.05333 14.1362 5.13635L10.2725 9.00005L14.1362 12.8637C14.3001 13.0335 14.3909 13.2608 14.3888 13.4968C14.3868 13.7328 14.2921 13.9585 14.1252 14.1254C13.9584 14.2923 13.7326 14.3869 13.4967 14.389C13.2607 14.391 13.0333 14.3003 12.8636 14.1363L8.99991 10.2726L5.13621 14.1363C4.96646 14.3003 4.73912 14.391 4.50314 14.389C4.26717 14.3869 4.04144 14.2923 3.87457 14.1254C3.7077 13.9585 3.61305 13.7328 3.611 13.4968C3.60895 13.2608 3.69966 13.0335 3.86361 12.8637L7.72731 9.00005L3.86361 5.13635C3.69488 4.96757 3.6001 4.7387 3.6001 4.50005C3.6001 4.2614 3.69488 4.03252 3.86361 3.86375Z"
                                      fill="#1B004E"/>
                            </svg>

                        </button>
                    </div>
                    <div class="toast-progress">
                        <div class="progress-bar"></div>
                    </div>
                </div>
            </div>
        </script>

    </div>
    <div class="tab-content hidden py-4" id="system-info" role="tabpanel" aria-labelledby="contacts-tab">
        <?php echo $this->getChildHtml('DiagnosticsBlock'); ?>
    </div>
</div>

<script type="text/javascript">
    // JavaScript for tab functionality
    const tabButton = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    tabButton.forEach(button => {
        button.addEventListener('click', () => {
            const target = button.getAttribute('data-tabs-target');
            document.querySelectorAll('.tab-btn').forEach(tabBtn => {
                tabBtn.classList.remove('tab-btn-active');
            });
            tabContents.forEach(tabContent => {
                tabContent.classList.add('hidden');

            });
            document.getElementById(target).classList.remove('hidden');
            button.classList.add('tab-btn-active');
        });

    });
</script>
<script type="text/javascript">
    require(['jquery', 'Magento_Ui/js/modal/alert', 'NitroPack_NitroPack/js/overlay'], function ($, magentoAlert, cardOverlay) {
        $(document).ready(function () {
            let extensionStatus = $('input[name=enabled]').val();
            if (extensionStatus == 1) {
                $('span[data-connection="connected"]').show();
                $('span[data-connection="disabled"]').hide();
            } else {
                $('span[data-connection="connected"]').hide();
                $('span[data-connection="disabled"]').show();
            }

            $(document).on('change', '#nitro_settings input[type=checkbox]', function () {
                let value = $(this).is(':checked') ? 1 : 0;
                let setting = $(this).attr('name');

                let data = {};
                data[setting] = value;
                let saveRequest = true;

                switch (setting) {
                    case 'cacheWarmup':
                        saveRequest = false;
                        break;
                    case 'enabled':
                        saveRequest = false;
                        break;
                    case 'safeMode':
                        saveRequest = false;
                        break;
                    case 'cache_to_login_customer':
                        $("#optimizations-widget").cardOverlay("loading", {message: "Purging cache"});
                        window.performCachePurge();
                        saveRequest = true;
                        break;
                }

                if (saveRequest) {
                    $.ajax({
                        url: '<?= $saveUrl ?>',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (response) {
                            if (response.saved) {
                                Notification.success('Saved successfully');

                            } else {
                                Notification.danger('Something went wrong');
                            }
                        }
                    });
                }
            });

            window.enableExtension = function (enabled) {
                $('#status').attr('disabled', 'disabled')
                var enabledValue = 0;
                if (enabled) {
                    enabledValue = 1;
                }
                $.ajax({
                    url: '<?= $saveUrl ?>',
                    method: 'POST',
                    dataType: 'json',
                    data: {"enabled": enabledValue},
                    success: function (response) {
                        $('#status').removeAttr('disabled');
                        if (response.saved) {
                            Notification.success('Saved successfully');
                            if (<?= $block->checkVarnishEnable()?>) {
                                $.get('<?=  $block->getVarnishPurgeUrl() ?>', function (data) {
                                });
                            }
                        } else {
                            Notification.danger('Something went wrong');
                        }
                    }
                });
            }


            window.setCacheWarmup = function (warmupEnabled) {

                $('#npCacheWarmupLoading').removeClass('hidden');
                $('.warmup-status-message').html('Estimating Optimization Usage');
                if (warmupEnabled) {
                    $.ajax({
                        url: '<?= $warmupStartUrl ?>',
                        method: 'POST',
                        dataType: 'json',
                        data: {run: 1},
                        success: function (response) {
                            // @TODO proper response handling
                            if (response.success) {
                                Notification.success('Successfully started warmup');
                            } else if (response.permissionsIssue) {
                                Notification.warning('[Un]Successfully did not start warmup. Permissions issue');
                            } else {
                                Notification.warning('[Un]Successfully did not start warmup');
                            }

                            $('#showEstimateLoadHeading').html('Estimating Optimization Usage');
                            $('#cacheWarmupPopup').hide();
                        }
                    });
                } else {
                    $.ajax({
                        url: '<?= $warmupPauseUrl ?>',
                        method: 'POST',
                        dataType: 'json',
                        data: {run: 1},
                        success: function (response) {
                            // @TODO proper response handling
                            if (response.paused) {
                            } else {
                                console.log('Pause failed', response);
                            }
                        }
                    });
                }
            }

            $('.disconnect').on('click', function (event) {
                $(this).addClass('disabled');
                event.preventDefault();
                $('.npDisconnectLoading').show();
                $.ajax({
                    url: '<?= $block->getDisconnectUrl() ?>',
                    method: 'GET',
                    success: function (response) {
                        $('.npDisconnectLoading').hide();
                        if (response.disconnected == true) {
                            $('.npDisconnectSuccess').show();
                            $('disconnect').removeClass('disabled');
                            if (<?= $block->checkVarnishEnable()?>) {
                                $.get('<?=  $block->getVarnishPurgeUrl() ?>', function (data) {
                                    window.location = '<?= $block->getConnectUrl() ?>';

                                });
                            } else {
                                window.location = '<?= $block->getConnectUrl() ?>';
                            }
                        }
                    }
                });
            });

            window.safeModeActive = function () {
                $('#safe_mode_active').addClass('disabled');
                enableSafemode();
            }

            window.safeModeDeactive = function (purge) {
                $('#safe_mode_deactive').addClass('disabled');
                disableSafeMode();
                if (purge == 'purge') {
                    performCachePurge()
                }

            }

            function pushAlertNotification(msg, status) {
                $('#container > .nitro').prepend('<div class="row"><div class="col"><div class="alert alert-' + status + ' alert-dismissible fade show" role="alert">' + msg + '<button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div></div></div>');
            }

        });
        var safeModeUrl = "<?= $safeModeEnableUrl; ?>";

        var enableSafemode = () => {

            $('#safe_mode').attr('disabled', 'disabled');

            $.post(safeModeUrl, {
                action: 'nitropack_enable_safemode'
            }, function (response) {
                $('#safe_mode').removeAttr('disabled');
                if (response.safe_mode == true) {
                    $('#safe_mode').prop("checked", true);
                    Notification.success('Success! Test mode has been enabled successfully!');
                    // Success notification
                } else {
                    Notification.warning('Error! There was an error while enabling Test mode!');
                }
            });
        }

        var disableSafeMode = () => {
            $('#safe_mode').attr('disabled', 'disabled');

            $.post(safeModeUrl, {
                action: 'nitropack_disable_safemode'
            }, function (response) {
                $('#safe_mode').removeAttr('disabled');
                if (response.safe_mode == false) {
                    // Success notification
                    Notification.success('Success! Test mode has been disabled successfully!');
                } else {
                    // Error notification
                    Notification.warning('Error! There was an error while enabling test mode!');
                }
            });
        }

        window.removeDisabledSafeModeBtn = function () {

            $('#safe_mode_active').removeClass('disabled');

            $('#safe_mode_deactive').removeClass('disabled');
        }
        window.loadNumberOfPageCount = 0;
        window.loadNumberOfPage = function () {
            //app.showCacheWarmupModal =true;
            if (window.loadNumberOfPageCount == 0) {
                $.get('<?= $numberOfPageStoreWiseUrl ?>', function (data) {
                    if (data.number_of_pages) {
                        $('#cacheWarmupPage').html(data.number_of_pages);
                        window.loadNumberOfPageCount = data.number_of_pages;
                        $('#npCacheWarmupLoading').addClass('hidden');
                        $('.warmup-status-message').html("Enabling cache warmup will optimize " + data.number_of_pages + " pages.");
                    }
                });

            } else {
                setTimeout(function () {

                    $('.warmup-status-message').html("Enabling cache warmup will optimize " + window.loadNumberOfPageCount + " pages.");
                    $('#npCacheWarmupLoading').addClass('hidden');


                }, 1000);
            }

        }

        window.isTestModeEnabled = <?= (isset($settings->safeMode) && $settings->safeMode ? "true" : "false");?>


        window.setTestMode = function (mode) {
            window.isTestModeEnabled = mode;
        }

        window.isTestMode = function () {

            if (window.isTestModeEnabled) {
                $('#test-mode-enabled').removeClass('hidden');
                $('#test-mode-disabled').addClass('hidden');
            } else {
                $('#test-mode-enabled').addClass('hidden');
                $('#test-mode-disabled').removeClass('hidden');
            }
        }

        window.closeModalOverlay = function () {
            $("#setting-widget").cardOverlay("clear");
        }

        function purgeCache() {
            let data = {'cache.purge': 1};
            return $.ajax({
                url: '<?= $purgeUrl ?>',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (response) {
                    if (response.purged) {
                        Notification.success(response.message);
                        let purgeEvent = new Event("cache.purge.success");
                        window.dispatchEvent(purgeEvent);

                    } else {
                        Notification.danger(response.message);

                    }
                },
                error: function (response, errType, msg) {
                    Notification.danger('Cache was not purged. Error type: ' + errType + '. Error message: ' + msg);
                }
            });
        }

        window.performCachePurge = () => {
            purgeCache();
            closeModalOverlay();
        }

    });
</script>
